<?php defined( '_VALID_MOS' ) or die( 'Direct Access to this location is not allowed.' );global $database,$mosConfig_offset,$mosConfig_live_site,$mainframe;$count =intval( $params->get( 'count',5 ) );$displayLen =intval( $params->get( 'displayLen',50 ) );$titleLen =intval( $params->get( 'titleLen',50 ) );$query=" SELECT a.contentid,a.comment,b.title FROM #__jomcomment as a,jos_content as b WHERE a.published=1 AND b.id=a.contentid GROUP BY a.contentid ORDER BY a.id DESC LIMIT 0,$count";$database->setQuery($query);$rows=$database->loadObjectList();class JomLatestMod { function wrapItUp($text,$width=20) { if (strlen($text) > $width) return (substr($text,0,$width)."...");else return $text;} function transformText ($source) { $decrement[4]=240;$decrement[3]=224;$decrement[2]=192;$decrement[1]=0;$shift[1][0]=0;$shift[2][0]=6;$shift[2][1]=0;$shift[3][0]=12;$shift[3][1]=6;$shift[3][2]=0;$shift[4][0]=18;$shift[4][1]=12;$shift[4][2]=6;$shift[4][3]=0;$pos=0;$len=strlen ($source);$encodedString='';while ($pos < $len) { $asciiPos=ord (substr ($source,$pos,1));if($asciiPos > 31 && $asciiPos <=127){ $encodedString.=substr ($source,$pos,1);$pos++;} else { if (($asciiPos >=240) && ($asciiPos <=255)) { $thisLetter=substr ($source,$pos,4);$pos+=4;} else if (($asciiPos >=224) && ($asciiPos <=239)) { $thisLetter=substr ($source,$pos,3);$pos+=3;} else if (($asciiPos >=192) && ($asciiPos <=223)) { $thisLetter=substr ($source,$pos,2);$pos+=2;} else { $thisLetter=substr ($source,$pos,1);$pos+=1;} $thisLen=strlen ($thisLetter);$thisPos=0;$decimalCode=0;while ($thisPos < $thisLen) { $thisCharOrd=ord (substr ($thisLetter,$thisPos,1));if ($thisPos==0) { $charNum=intval ($thisCharOrd-$decrement[$thisLen]);$decimalCode+=($charNum << $shift[$thisLen][$thisPos]);} else { $charNum=intval ($thisCharOrd-128);$decimalCode+=($charNum << $shift[$thisLen][$thisPos]);} $thisPos++;} if ($thisLen==1) $encodedLetter="&#".str_pad($decimalCode,3,"0",STR_PAD_LEFT).';';else $encodedLetter="&#".str_pad($decimalCode,5,"0",STR_PAD_LEFT).';';$encodedString.=$encodedLetter;} } return $encodedString;} } ?> <table width="100%" border="0" cellspacing="0" cellpadding="0"> <?php $jomLatestMod=new JomLatestMod;if($rows){ foreach($rows as $row){ $link=sefRelToAbs('index.php?option=com_content&amp;task=view&amp;id='.$row->contentid.'&amp;Itemid='.$mainframe->getItemid($row->contentid).'')."#jc_allComments";$comment=$jomLatestMod->wrapItUp($row->comment,$displayLen);$comment=$jomLatestMod->transformText($comment);echo "<tr><td>";echo "<a href='$link'>".$jomLatestMod->wrapItUp($row->title,$titleLen)."</a>";echo "<br/><span class='small' style='overflow:hidden;'>$comment</span>";echo "</td></tr>";} } ?> </table> <?php ?>
